<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="qjqVOvRhHfsuDbLOvaAnj2mkUZJ9Xwzg84TMVXduvUc" />

    <meta charset="UTF-8">
    <title>Hyperloop - Hyper-React Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

    <!-- <link href="/stylesheets/base.css" rel="stylesheet" />
    <link href="/stylesheets/normalize.css" rel="stylesheet" />
    <link href="/stylesheets/stylesheet.css" rel="stylesheet" />
    <link href="/stylesheets/github-light.css" rel="stylesheet" /> -->

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="https://rawgit.com/reactrb/reactrb-express/master/reactrb-express.js"></script>

    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>

    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/codemirror.js"></script>
    <script src="/javascripts/ruby.js"></script>
    <script src="/javascripts/matchbrackets.js"></script>

    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="/stylesheets/override.css" rel="stylesheet" />
    <!-- <link href="/stylesheets/code.css" rel="stylesheet" /> -->
    <link href="/stylesheets/github.css" rel="stylesheet" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
    <link href="/stylesheets/codemirror.css" rel="stylesheet" />

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>

  <body>
    <div class="container">
      <nav class="navbar navbar-ligh">
  <button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2" aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-toggleable-xs" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a href="/" class="nav-link">Hyperloop</a>
      </li>
      <li class="nav-item">
        <a href="/get_started" class="nav-link active">Get Started</a>
      </li>
      <li class="nav-item">
        <a href="/tutorials" class="nav-link">Tutorials</a>
      </li>
      <li class="nav-item">
        <a href="/installation" class="nav-link">Installation</a>
      </li>
      <li class="nav-item">
        <a href="/gems" class="nav-link">Gems</a>
      </li>
      <li class="nav-item">
        <a href="https://github.com/ruby-hyperloop" class="nav-link">Github</a>
      </li>
      <li class="nav-item">
        <a href="/tools" class="nav-link">Tools</a>
      </li>
      <li class="nav-item">
        <a href="/docs/dsl_overview" class="nav-link">Docs</a>
      </li>
      <li class="nav-item">
        <a href="/support" class="nav-link">Support</a>
      </li>
      <li class="nav-item">
        <a href="/blog" class="nav-link">Blog</a>
      </li>
    </ul>
  </div>
</nav>

    </div>

    <div class="jumbotron page-header">
      <div class="container">
        <div class="row hidden-xs-down">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop_white.svg" width="180" alt="Hyperloop white" />
          </div>
          <div class="col-md-9">
            <h1 class="display-4 project-name">Hyperloop</h1>
            </br>
            <h2 class="display-7 project-tagline">
              HYPER-REACT DOCS
            </h2>
          </div>
        </div>
        <div class="row hidden-sm-up">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop_white.svg" width="120" alt="Hyperloop white" />
          </div>
          <div class="col-md-9">
            <h1 class="h1 project-name center-text">Hyperloop</h1>
            </br>
            <h2 class="h4 project-tagline center-text">
              HYPER-REACT DOCS
            </h2>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-3">
            <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/dsl_overview">HyperReact Overview</a></strong></br></li>
    <li class="nav-item"><a href="/docs/components_and_state">Components and State</a></br></li>
    <li class="nav-item"><a href="/docs/lifecycle_callbacks">Lifecycle Callbacks</a></br></li>
    <li class="nav-item"><a href="/docs/lifecycle_methods">Lifecycle Methods</a></br></li>
    <li class="nav-item"><a href="/docs/event_handelers">Event Handelers</a></br></li>
    <li class="nav-item"><a href="/docs/elements_rendering">Elements and Rendering</a></br></li>
    <li class="nav-item"><a href="/docs/javascript_components">Javascript Components</a></br></li>
    <li class="nav-item"><a href="/docs/further_reading">Further Reading</a></br></li>
  </ul>
  <br>
  <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/hypermesh_overview">HyperMesh Overview</a></strong></li>
    <li class="nav-item"><a href="/docs/hypermesh_active_record">ActiveRecord API</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_scoping">Scoping</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_authorization">Authorization</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_debugging">Debugging</a></br></li>
  </ul>

          <br>
        </div>
        <div class="col-md-9 main-content">
          <h2 id="components-and-state">Components and State</h2>

<ul>
<li><a href="#using-state">Using State</a></li>
<li><a href="#multiple-components">Multiple Components</a></li>
<li><a href="#reusable-components">Reusable Components</a></li>
<li><a href="#param-validation">Param Validation</a></li>
<li><a href="#default-param-values">Default Param Values</a></li>
<li><a href="#params-of-type-proc">Params of type Proc</a></li>
<li><a href="#other-params">Other Params</a></li>
<li><a href="#mixins-and-inheritance">Mixins and Inheritance</a></li>
</ul>

<h3 id="using-state">Using State</h3>

<h4 id="a-simple-example">A Simple Example</h4>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">LikeButton</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">render</span> <span class="k">do</span>
    <span class="n">para</span> <span class="k">do</span>
      <span class="s2">"You </span><span class="si">#{</span><span class="n">state</span><span class="p">.</span><span class="nf">liked</span> <span class="p">?</span> <span class="s1">'like'</span> <span class="p">:</span> <span class="s1">'haven\'t liked'</span><span class="si">}</span><span class="s2"> this. Click to toggle."</span>
    <span class="k">end</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">state</span><span class="p">.</span><span class="nf">liked!</span> <span class="o">!</span><span class="n">state</span><span class="p">.</span><span class="nf">liked</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p><a href="http://goo.gl/fWUOOe">Try It Out</a></p>

<h3 id="components-are-just-state-machines">Components are Just State Machines</h3>

<p>React thinks of UIs as simple state machines. By thinking of a UI as being in various states and rendering those states, it&#39;s easy to keep your UI consistent.</p>

<p>In React, you simply update a component&#39;s state, and then the new UI will be rendered on this new state. React takes care of updating the DOM for you in the most efficient way.</p>

<h3 id="how-state-works">How State Works</h3>

<p>Whenever a state variable changes you invoke the corresponding state variable name followed by a &quot;!&quot; method.  For example <code>state.liked! !state.like</code> <em>gets</em> the current value of like, toggles it, and then <em>updates</em> it.  This in turn causes the component to be rerendered. For more details on how this works, and the full syntax of the update method see <a href="#top-level-api">the component API reference</a></p>

<h3 id="what-components-should-have-state">What Components Should Have State?</h3>

<p>Most of your components should simply take some params and render based on their value. However, sometimes you need to respond to user input, a server request or the passage of time. For this you use state.</p>

<p><strong>Try to keep as many of your components as possible stateless.</strong> By doing this you&#39;ll isolate the state to its most logical place and minimize redundancy, making it easier to reason about your application.</p>

<p>A common pattern is to create several stateless components that just render data, and have a stateful component above them in the hierarchy that passes its state to its children via <code>params</code>. The stateful component encapsulates all of the interaction logic, while the stateless components take care of rendering data in a declarative way.</p>

<h3 id="what-should-go-in-state">What <em>Should</em> Go in State?</h3>

<p><strong>State should contain data that a component&#39;s event handlers, timers, or http requests may change and trigger a UI update.</strong></p>

<p>When building a stateful component, think about the minimal possible representation of its state, and only store those properties in <code>state</code>.  Add to your class methods to compute higher level values from your state variables.  Avoid adding redundant or computed values as state variables as
these values must then be kept in sync whenever state changes.</p>

<h3 id="what-shouldnt-go-in-state">What <em>Shouldn&#39;t</em> Go in State?</h3>

<p><code>state</code> should only contain the minimal amount of data needed to represent your UI&#39;s state. As such, it should not contain:</p>

<ul>
<li><strong>Computed data:</strong> Don&#39;t worry about precomputing values based on state — it&#39;s easier to ensure that your UI is consistent if you do all computation during rendering.  For example, if you have an array of list items in state and you want to render the count as a string, simply render <code>&quot;#{state.list_items.length} list items&#39;</code> in your <code>render</code> method rather than storing the count as another state.</li>
<li><strong>Data that does not effect rendering:</strong> For example handles on timers, that need to be cleaned up when a component unmounts should go
in plain old instance variables.</li>
</ul>

<h2 id="multiple-components">Multiple Components</h2>

<p>So far, we&#39;ve looked at how to write a single component to display data and handle user input. Next let&#39;s examine one of React&#39;s finest features: composability.</p>

<h3 id="motivation-separation-of-concerns">Motivation: Separation of Concerns</h3>

<p>By building modular components that reuse other components with well-defined interfaces, you get much of the same benefits that you get by using functions or classes. Specifically you can <em>separate the different concerns</em> of your app however you please simply by building new components. By building a custom component library for your application, you are expressing your UI in a way that best fits your domain.</p>

<h3 id="composition-example">Composition Example</h3>

<p>Let&#39;s create a simple Avatar component which shows a profile picture and username using the Facebook Graph API.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Avatar</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:user_name</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">div</span> <span class="k">do</span>
      <span class="no">ProfilePic</span>  <span class="ss">user_name: </span><span class="n">params</span><span class="p">.</span><span class="nf">user_name</span>
      <span class="no">ProfileLink</span> <span class="ss">user_name: </span><span class="n">params</span><span class="p">.</span><span class="nf">user_name</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">ProfilePic</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:user_name</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">img</span> <span class="ss">src: </span><span class="s2">"https://graph.facebook.com/</span><span class="si">#{</span><span class="n">params</span><span class="p">.</span><span class="nf">user_name</span><span class="si">}</span><span class="s2">/picture"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">ProfileLink</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:user_name</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">a</span> <span class="ss">href: </span><span class="s2">"https://www.facebook.com/</span><span class="si">#{</span><span class="n">params</span><span class="p">.</span><span class="nf">user_name</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">user_name</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="ownership">Ownership</h3>

<p>In the above example, instances of <code>Avatar</code> <em>own</em> instances of <code>ProfilePic</code> and <code>ProfileLink</code>. In React, <strong>an owner is the component that sets the <code>params</code> of other components</strong>. More formally, if a component <code>X</code> is created in component <code>Y</code>&#39;s <code>render</code> method, it is said that <code>X</code> is <em>owned by</em> <code>Y</code>. As discussed earlier, a component cannot mutate its <code>params</code> — they are always consistent with what its owner sets them to. This fundamental invariant leads to UIs that are guaranteed to be consistent.</p>

<p>It&#39;s important to draw a distinction between the owner-ownee relationship and the parent-child relationship. The owner-ownee relationship is specific to React, while the parent-child relationship is simply the one you know and love from the DOM. In the example above, <code>Avatar</code> owns the <code>div</code>, <code>ProfilePic</code> and <code>ProfileLink</code> instances, and <code>div</code> is the <strong>parent</strong> (but not owner) of the <code>ProfilePic</code> and <code>ProfileLink</code> instances.</p>

<h3 id="children">Children</h3>

<p>When you create a React component instance, you can include additional React components or JavaScript expressions between the opening and closing tags like this:</p>
<pre class="highlight ruby"><code><span class="no">Parent</span> <span class="p">{</span> <span class="no">Child</span><span class="p">()</span> <span class="p">}</span>
</code></pre>
<p><code>Parent</code> can iterate over its children by accessing its <code>children</code> method.</p>

<h3 id="child-reconciliation">Child Reconciliation</h3>

<p><strong>Reconciliation is the process by which React updates the DOM with each new render pass.</strong> In general, children are reconciled according to the order in which they are rendered. For example, suppose we have the following render method displaying a list of items.  On each pass
the items will be completely rerendered:</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">render</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="n">para</span> <span class="k">do</span>
      <span class="n">item</span><span class="p">[</span><span class="ss">:text</span><span class="p">]</span>
    <span class="n">endt</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>What if the first time items was <code>[{text: &quot;foo&quot;}, {text: &quot;bar&quot;}]</code>, and the second time items was <code>[{text: &quot;bar&quot;}]</code>?
Intuitively, the paragraph <code>&lt;p&gt;foo&lt;/p&gt;</code> was removed. Instead, React will reconcile the DOM by changing the text content of the first child and destroying the last child. React reconciles according to the <em>order</em> of the children.</p>

<h3 id="stateful-children">Stateful Children</h3>

<p>For most components, this is not a big deal. However, for stateful components that maintain data in <code>state</code> across render passes, this can be very problematic.</p>

<p>In most cases, this can be sidestepped by hiding elements based on some property change:</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">render</span>
  <span class="n">state</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="n">para</span><span class="p">(</span><span class="ss">style: </span><span class="p">{</span><span class="ss">display: </span><span class="n">item</span><span class="p">[</span><span class="ss">:some_property</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"some state"</span> <span class="p">?</span> <span class="p">:</span><span class="n">block</span> <span class="p">:</span> <span class="ss">:none</span><span class="p">})</span> <span class="k">do</span>
      <span class="n">item</span><span class="p">[</span><span class="ss">:text</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="dynamic-children">Dynamic Children</h3>

<p>The situation gets more complicated when the children are shuffled around (as in search results) or if new components are added onto the front of the list (as in streams). In these cases where the identity and state of each child must be maintained across render passes, you can uniquely identify each child by assigning it a <code>key</code>:</p>
<pre class="highlight ruby"><code>  <span class="n">param</span> <span class="ss">:results</span><span class="p">,</span> <span class="ss">type: </span><span class="p">[</span><span class="no">Hash</span><span class="p">]</span> <span class="c1"># each result is a hash of the form {id: ..., text: ....}</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">ol</span> <span class="k">do</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">results</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
        <span class="n">li</span><span class="p">(</span><span class="ss">key: </span><span class="n">result</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span> <span class="p">{</span> <span class="n">result</span><span class="p">[</span><span class="ss">:text</span><span class="p">]</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<p>When React reconciles the keyed children, it will ensure that any child with <code>key</code> will be reordered (instead of clobbered) or destroyed (instead of reused).</p>

<p>The <code>key</code> should <em>always</em> be supplied directly to the components in the array, not to the container HTML child of each component in the array:</p>
<pre class="highlight ruby"><code>  <span class="c1"># WRONG!</span>
<span class="k">class</span> <span class="nc">ListItemWrapper</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:data</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">li</span><span class="p">(</span><span class="ss">key: </span><span class="n">params</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span> <span class="p">{</span> <span class="n">params</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="ss">:text</span><span class="p">]</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>    
<span class="k">class</span> <span class="nc">MyComponent</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:results</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">ul</span> <span class="k">do</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">result</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
        <span class="no">ListItemWrapper</span> <span class="ss">data: </span><span class="n">result</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre><pre class="highlight ruby"><code>  <span class="c1"># correct</span>
<span class="k">class</span> <span class="nc">ListItemWrapper</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:data</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">li</span><span class="p">{</span> <span class="n">params</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="ss">:text</span><span class="p">]</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>    
<span class="k">class</span> <span class="nc">MyComponent</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:results</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">ul</span> <span class="k">do</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">result</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
        <span class="no">ListItemWrapper</span> <span class="ss">key: </span><span class="n">result</span><span class="p">[</span><span class="ss">:id</span><span class="p">],</span> <span class="ss">data: </span><span class="n">result</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="data-flow">Data Flow</h3>

<p>In React, data flows from owner to owned component through the params as discussed above. This is effectively one-way data binding: owners bind their owned component&#39;s param to some value the owner has computed based on its <code>params</code> or <code>state</code>. Since this process happens recursively, data changes are automatically reflected everywhere they are used.</p>

<h2 id="reusable-components">Reusable Components</h2>

<p>When designing interfaces, break down the common design elements (buttons, form fields, layout components, etc.) into reusable components with well-defined interfaces. That way, the next time you need to build some UI, you can write much less code. This means faster development time, fewer bugs, and fewer bytes down the wire.</p>

<h2 id="param-validation">Param Validation</h2>

<p>As your app grows it&#39;s helpful to ensure that your components are used correctly. We do this by allowing you to specify the expected ruby class of your parameters. When an invalid value is provided for a param, a warning will be shown in the JavaScript console. Note that for performance reasons type checking is only done in development mode. Here is an example showing typical type specifications:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">ManyParams</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:an_array</span><span class="p">,</span>         <span class="ss">type: </span><span class="p">[]</span> <span class="c1"># or type: Array</span>
  <span class="n">param</span> <span class="ss">:a_string</span><span class="p">,</span>         <span class="ss">type: </span><span class="no">String</span>
  <span class="n">param</span> <span class="ss">:array_of_strings</span><span class="p">,</span> <span class="ss">type: </span><span class="p">[</span><span class="no">String</span><span class="p">]</span>
  <span class="n">param</span> <span class="ss">:a_hash</span><span class="p">,</span>           <span class="ss">type: </span><span class="no">Hash</span>
  <span class="n">param</span> <span class="ss">:some_class</span><span class="p">,</span>       <span class="ss">type: </span><span class="no">SomeClass</span> <span class="c1"># works with any class</span>
  <span class="n">param</span> <span class="ss">:a_string_or_nil</span><span class="p">,</span>  <span class="ss">type: </span><span class="no">String</span><span class="p">,</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<p>Note that if the param can be nil, add <code>allow_nil: true</code> to the specification.</p>

<h2 id="default-param-values">Default Param Values</h2>

<p>React lets you define default values for your <code>params</code>:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">ManyParams</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:an_optional_param</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"hello"</span><span class="p">,</span> <span class="ss">type: </span><span class="no">String</span><span class="p">,</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
</code></pre>
<p>If no value is provided for <code>:an_optional_param</code> it will be given the value <code>&quot;hello&quot;</code></p>

<h2 id="params-of-type-proc">Params of type Proc</h2>

<p>A Ruby <code>Proc</code> can be passed to a component like any other object.  The <code>param</code> macro treats params declared as type <code>Proc</code> specially, and will automatically call the proc when the param name is used on the params method.</p>
<pre class="highlight ruby"><code><span class="n">param</span> <span class="ss">:all_done</span><span class="p">,</span> <span class="ss">type: </span><span class="no">Proc</span>
<span class="p">.</span><span class="nf">.</span><span class="o">.</span>
  <span class="c1"># typically in an event handler</span>
<span class="n">params</span><span class="p">.</span><span class="nf">all_done</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># instead of params.all_done.call(data)</span>
</code></pre>
<p>Proc params can be optional, using the <code>default: nil</code> and <code>allow_nil: true</code> options.  Invoking a nil proc param will do nothing.  This is handy for allowing optional callbacks.</p>

<h2 id="other-params">Other Params</h2>

<p>A common type of React component is one that extends a basic HTML element in a simple way. Often you&#39;ll want to copy any HTML attributes passed to your component to the underlying HTML element.</p>

<p>To do this use the <code>collect_other_params_as</code> macro which will gather all the params you did not declare into a hash. Then you can pass this hash on to the child component</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">CheckLink</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">collect_other_params_as</span> <span class="ss">:attributes</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="c1"># we just pass along any incoming attributes</span>
    <span class="n">a</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'√ '</span><span class="p">.</span><span class="nf">span</span><span class="p">;</span> <span class="n">children</span><span class="p">.</span><span class="nf">each</span> <span class="o">&amp;</span><span class="ss">:render</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Element</span><span class="p">[</span><span class="s1">'#container'</span><span class="p">].</span><span class="nf">render</span> <span class="p">{</span> <span class="no">CheckLink</span><span class="p">(</span><span class="ss">href: </span><span class="s2">"/checked.html"</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"Click here!"</span> <span class="p">}}</span>
</code></pre>
<p><a href="http://goo.gl/ZG4ZJg">Try It Out</a></p>

<p>Note: <code>collect_other_params_as</code> builds a hash, so you can merge other data in or even delete elements out as needed.</p>

<h2 id="mixins-and-inheritance">Mixins and Inheritance</h2>

<p>Ruby has a rich set of mechanisms enabling code reuse, and HyperReact is intended to be a team player in your Ruby application.  Components can be subclassed, and they can include (or mixin) other modules.  You can also create a component by including <code>React::Component</code> which allows a class to inherit from some other non-react class, and then mixin the React DSL.</p>
<pre class="highlight ruby"><code>  <span class="c1"># make a SuperFoo react component class</span>
  <span class="k">class</span> <span class="nc">Foo</span> <span class="o">&lt;</span> <span class="no">SuperFoo</span>
    <span class="kp">include</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span>
  <span class="k">end</span>
</code></pre>
<p>One common use case is a component wanting to update itself on a time interval. It&#39;s easy to use the kernel method <code>every</code>, but it&#39;s important to cancel your interval when you don&#39;t need it anymore to save memory. React provides <a href="/docs/working-with-the-browser.html#component-lifecycle">lifecycle methods</a> that let you know when a component is about to be created or destroyed. Let&#39;s create a simple mixin that uses these methods to provide a React friendly <code>every</code> function that will automatically get cleaned up when your component is destroyed.</p>
<pre class="highlight ruby"><code><span class="k">module</span> <span class="nn">ReactInterval</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="p">.</span><span class="nf">before_mount</span> <span class="k">do</span>
      <span class="vi">@intervals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">end</span>

    <span class="n">base</span><span class="p">.</span><span class="nf">before_unmount</span> <span class="k">do</span>
      <span class="vi">@intervals</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:stop</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">every</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="no">Kernel</span><span class="p">.</span><span class="nf">every</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">).</span><span class="nf">tap</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="vi">@intervals</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">TickTock</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">ReactInterval</span>
  <span class="n">before_mount</span> <span class="k">do</span>
    <span class="n">state</span><span class="p">.</span><span class="nf">seconds!</span> <span class="mi">0</span>
  <span class="k">end</span>
  <span class="n">after_mount</span> <span class="k">do</span>
    <span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="nf">seconds!</span> <span class="n">state</span><span class="p">.</span><span class="nf">seconds</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="s2">"React has been running for </span><span class="si">#{</span><span class="n">state</span><span class="p">.</span><span class="nf">seconds</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">.</span><span class="nf">para</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p><a href="http://goo.gl/C4IJu0">Try It Out</a></p>

<p>Notice that TickTock effectively has two before_mount callbacks, one that is called to initialize the <code>@intervals</code> array and another to initialize <code>state.seconds</code></p>

        </div>
      </div>
    </div>

    <script>
      (function(Opal) {
        var self = Opal.top, $scope = Opal, nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;
        Opal.add_stubs(['$puts']);
        return self.$puts("Opal ok")
      })(Opal);
    </script>

    <!-- <script   src="http://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> -->

    <script type="text/ruby">puts "Hyperloop Express ok"</script>

    <script type="text/ruby">

class CodeMirror < React::Component::Base
  param :code, type: String
  define_state :error_message

  before_mount do
    state.error_message! ""
  end

  after_mount do
    @editor = `CodeMirror(document.getElementById("code"), {
      value: #{params.code},
      mode: "text/x-ruby",
      matchBrackets: true,
      lineNumbers: true,
      indentUnit: 2,
      theme: 'github'
    });`
    `#{@editor}.on('change', #{lambda {on_change} })`
    execute_code
  end

  render(DIV) do
    div(id: 'code')
    br
    div(id: 'result')
    p { state.error_message }
  end

  def on_change
    state.error_message! ""
    execute_code
  end

  after_mount   :execute_code
  after_update  :execute_code

  def execute_code
    compiled_code = Opal::Compiler.new(`#{@editor}.getValue()`).compile
    `ReactDOM.unmountComponentAtNode(document.getElementById("result"));`
    `eval(#{compiled_code})`
    Element['#result'].render{ Alfie() }
    rescue Exception => e
    @time_out = after(0.5) do
      state.error_message! e.message
    end
  end

end

class TestApp < React::Component::Base
  param :name
  before_mount { @timer = every(1) { force_update! } }
  render(DIV) do
    h1 {"The current time is #{Time.now}"}
    h2 { "here hello #{params.name}" }.on(:click) do
     alert "you clicked"
    end
  end
end

</script>


  </body>
</html>
