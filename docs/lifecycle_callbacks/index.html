<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="qjqVOvRhHfsuDbLOvaAnj2mkUZJ9Xwzg84TMVXduvUc" />

    <meta charset="UTF-8">
    <title>Hyperloop - Hyper-React Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

    <!-- <link href="/stylesheets/base.css" rel="stylesheet" />
    <link href="/stylesheets/normalize.css" rel="stylesheet" />
    <link href="/stylesheets/stylesheet.css" rel="stylesheet" />
    <link href="/stylesheets/github-light.css" rel="stylesheet" /> -->

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="https://rawgit.com/reactrb/reactrb-express/master/reactrb-express.js"></script>

    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>

    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/codemirror.js"></script>
    <script src="/javascripts/ruby.js"></script>
    <script src="/javascripts/matchbrackets.js"></script>

    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="/stylesheets/override.css" rel="stylesheet" />
    <!-- <link href="/stylesheets/code.css" rel="stylesheet" /> -->
    <link href="/stylesheets/github.css" rel="stylesheet" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
    <link href="/stylesheets/codemirror.css" rel="stylesheet" />

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>

  <body>
    <div class="container">
      <nav class="navbar navbar-ligh">
  <button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2" aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-toggleable-xs" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a href="/" class="nav-link">Hyperloop</a>
      </li>
      <li class="nav-item">
        <a href="/get_started" class="nav-link active">Get Started</a>
      </li>
      <li class="nav-item">
        <a href="/tutorials" class="nav-link">Tutorials</a>
      </li>
      <li class="nav-item">
        <a href="/installation" class="nav-link">Installation</a>
      </li>
      <li class="nav-item">
        <a href="/gems" class="nav-link">Gems</a>
      </li>
      <li class="nav-item">
        <a href="https://github.com/ruby-hyperloop" class="nav-link">Github</a>
      </li>
      <li class="nav-item">
        <a href="/tools" class="nav-link">Tools</a>
      </li>
      <li class="nav-item">
        <a href="/docs/dsl_overview" class="nav-link">Docs</a>
      </li>
      <li class="nav-item">
        <a href="/support" class="nav-link">Support</a>
      </li>
      <li class="nav-item">
        <a href="/blog" class="nav-link">Blog</a>
      </li>
    </ul>
  </div>
</nav>

    </div>

    <div class="jumbotron page-header">
      <div class="container">
        <div class="row hidden-xs-down">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop_white.svg" width="180" alt="Hyperloop white" />
          </div>
          <div class="col-md-9">
            <h1 class="display-4 project-name">Hyperloop</h1>
            </br>
            <h2 class="display-7 project-tagline">
              HYPER-REACT DOCS
            </h2>
          </div>
        </div>
        <div class="row hidden-sm-up">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop_white.svg" width="120" alt="Hyperloop white" />
          </div>
          <div class="col-md-9">
            <h1 class="h1 project-name center-text">Hyperloop</h1>
            </br>
            <h2 class="h4 project-tagline center-text">
              HYPER-REACT DOCS
            </h2>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-3">
            <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/dsl_overview">HyperReact Overview</a></strong></br></li>
    <li class="nav-item"><a href="/docs/components_and_state">Components and State</a></br></li>
    <li class="nav-item"><a href="/docs/lifecycle_callbacks">Lifecycle Callbacks</a></br></li>
    <li class="nav-item"><a href="/docs/lifecycle_methods">Lifecycle Methods</a></br></li>
    <li class="nav-item"><a href="/docs/event_handelers">Event Handelers</a></br></li>
    <li class="nav-item"><a href="/docs/elements_rendering">Elements and Rendering</a></br></li>
    <li class="nav-item"><a href="/docs/javascript_components">Javascript Components</a></br></li>
    <li class="nav-item"><a href="/docs/further_reading">Further Reading</a></br></li>
  </ul>
  <br>
  <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/hypermesh_overview">HyperMesh Overview</a></strong></li>
    <li class="nav-item"><a href="/docs/hypermesh_active_record">ActiveRecord API</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_scoping">Scoping</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_authorization">Authorization</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_debugging">Debugging</a></br></li>
  </ul>

          <br>
        </div>
        <div class="col-md-9 main-content">
          <h2 id="lifecycle-callbacks">Lifecycle Callbacks</h2>

<p>A component may define callbacks for each phase of the components lifecycle:</p>

<ul>
<li><code>before_mount</code></li>
<li><code>render</code></li>
<li><code>after_mount</code></li>
<li><code>before_receive_props</code></li>
<li><code>before_update</code></li>
<li><code>after_update</code></li>
<li><code>before_unmount</code></li>
</ul>

<p>All the callback macros may take a block or the name of an instance method to be called.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">AComponent</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_mount</span> <span class="k">do</span>
    <span class="c1"># initialize stuff here</span>
  <span class="k">end</span>
  <span class="n">before_unmount</span> <span class="ss">:cleanup</span>  <span class="c1"># call the cleanup method before unmounting</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Except for the render callback, multiple callbacks may be defined for each lifecycle phase, and will be executed in the order defined, and from most deeply nested subclass outwards.</p>

<p>Details on the component lifecycle is described <a href="docs/component-specs.html">here</a></p>

<h3 id="the-param-macro">The <code>param</code> macro</h3>

<p>Within a React Component the <code>param</code> macro is used to define the parameter signature of the component.  You can think of params as
the values that would normally be sent to the instance&#39;s <code>initialize</code> method, but with the difference that a React Component gets new parameters when it is rerendered.  </p>

<p>The param macro has the following syntax:</p>
<pre class="highlight ruby"><code><span class="n">param</span> <span class="n">symbol</span><span class="p">,</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span><span class="nf">options</span><span class="p">.</span><span class="nf">.</span><span class="o">.</span> <span class="c1"># or</span>
<span class="n">param</span> <span class="n">symbol</span> <span class="o">=&gt;</span> <span class="n">default_value</span><span class="p">,</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span><span class="nf">options</span><span class="p">.</span><span class="nf">.</span><span class="o">.</span>
</code></pre>
<p>Available options are <code>:default_value =&gt; ...any value...</code> and <code>:type =&gt; ...class_spec...</code>
where class_spec is either a class name, or <code>[]</code> (shorthand for Array), or <code>[ClassName]</code> (meaning array of <code>ClassName</code>.)</p>

<p>Note that the default value can be specied either as the hash value of the symbol, or explicitly using the <code>:default_value</code> key.</p>

<p>Examples:</p>
<pre class="highlight ruby"><code><span class="n">param</span> <span class="ss">:foo</span> <span class="c1"># declares that we must be provided with a parameter foo when the component is instantiated or re-rerendered.</span>
<span class="n">param</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="s2">"some default"</span>        <span class="c1"># declares that foo is optional, and if not present the value "some default" will be used.</span>
<span class="n">param</span> <span class="ss">foo: </span><span class="s2">"some default"</span>           <span class="c1"># same as above using ruby 1.9 JSON style syntax</span>
<span class="n">param</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"some default"</span> <span class="c1"># same as above but uses explicit default key</span>
<span class="n">param</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">type: </span><span class="no">String</span>            <span class="c1"># foo is required and must be of type String</span>
<span class="n">param</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">type: </span><span class="p">[</span><span class="no">String</span><span class="p">]</span>          <span class="c1"># foo is required and must be an array of Strings</span>
<span class="n">param</span> <span class="ss">foo: </span><span class="p">[],</span> <span class="ss">type: </span><span class="p">[</span><span class="no">String</span><span class="p">]</span>       <span class="c1"># foo must be an array of strings, and has a default value of the empty array.</span>
</code></pre>
<h4 id="accessing-param-values">Accessing param values</h4>

<p>The component instance method <code>params</code> gives access to all declared params.  So for example</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Hello</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">visitor: </span><span class="s2">"World"</span><span class="p">,</span> <span class="ss">type: </span><span class="no">String</span>
  <span class="n">render</span>
    <span class="s2">"Hello </span><span class="si">#{</span><span class="n">params</span><span class="p">.</span><span class="nf">visitor</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h4 id="params-of-type-proc">Params of type <code>Proc</code></h4>

<p>A param of type proc (i.e. <code>param :update, type: Proc</code>) gets special treatment that will directly
call the proc when the param is accessed.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Alarm</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">:at</span><span class="p">,</span> <span class="ss">type: </span><span class="no">Time</span>
  <span class="n">param</span> <span class="ss">:notify</span><span class="p">,</span> <span class="ss">type: </span><span class="no">Proc</span>
  <span class="n">after_mount</span> <span class="k">do</span>
    <span class="vi">@clock</span> <span class="o">=</span> <span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span>
      <span class="k">if</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">.</span><span class="nf">at</span>
        <span class="n">params</span><span class="p">.</span><span class="nf">notify</span>
        <span class="vi">@clock</span><span class="p">.</span><span class="nf">stop</span>
      <span class="k">end</span>
      <span class="n">force_update!</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="s2">"</span><span class="si">#{</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>If for whatever reason you need to get the actual proc instead of calling it use <code>params.method(*symbol name of method*)</code></p>

<h3 id="the-state-instance-method">The <code>state</code> instance method</h3>

<p>React state variables are <em>reactive</em> component instance variables that cause rerendering when they change.</p>

<p>State variables are accessed via the <code>state</code> instance method which works like the <code>params</code> method. Like normal instance variables, state variables are created when they are first accessed, so there is no explicit declaration.  </p>

<p>To access the value of a state variable <code>foo</code> you would say <code>state.foo</code>.  </p>

<p>To initialize or update a state variable you use its name followed by <code>!</code>.  For example <code>state.foo! []</code> would initialize <code>foo</code> to an empty array.  Unlike the assignment operator, the update method returns the current value (before it is changed.)</p>

<p>Often state variables have complex values with their own internal state, an array for example.  The problem is as you push new values onto the array you are not changing the object pointed to by the state variable, but its internal state.</p>

<p>To handle this use the same &quot;!&quot; suffix with <strong>no</strong> parameter, and then apply any update methods to the resulting value.  The underlying value will be updated, <strong>and</strong> the underlying system will be notified that a state change has occurred.</p>

<p>For example
<code>ruby
  state.foo! []    # initialize foo (returns nil)
  ...later...
  state.foo! &lt;&lt; 12  # push 12 onto foo&#39;s array
  ...or...
  state.foo! {}
  state.foo![:house =&gt; :boat]
</code></p>

<p>The rule is simple:  anytime you are updating a state variable follow it by the &quot;!&quot;.</p>

<blockquote>
<h4 id="tell-me-how-that-works">Tell Me How That Works???</h4>

<p>A state variables update method (name followed by &quot;!&quot;) can optionally accept one parameter.  If a parameter is passed, then the method will 1) save the current value, 2) update the value to the passed parameter, 3) update the underlying react.js state object, 4) return the saved value.</p>
</blockquote>

<h3 id="the-force_update-method">The <code>force_update!</code> method</h3>

<p>The <code>force_update!</code> instance method causes the component to re-render.  Usually this is not necessary as rendering will occur when state variables change, or new params are passed.  For a good example of using <code>force_update!</code> see the <code>Alarm</code> component above.  In this case there is no reason to have a state track of the time separately, so we just call <code>force_update!</code> every second.</p>

<h3 id="the-dom_node-method">The <code>dom_node</code> method</h3>

<p>Returns the dom<em>node that this component instance is mounted to.  Typically used in the `after</em>mount` callback to setup linkages to external libraries.</p>

<h3 id="the-children-method">The <code>children</code> method</h3>

<p>Along with params components may be passed a block which is used to build the components children.</p>

<p>The instance method <code>children</code> returns an enumerable that is used to access the unrendered children of a component.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">IndentEachLine</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">param</span> <span class="ss">by: </span><span class="mi">20</span><span class="p">,</span> <span class="ss">type: </span><span class="no">Integer</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">div</span> <span class="k">do</span>
      <span class="n">children</span><span class="p">.</span><span class="nf">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
        <span class="n">child</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">style: </span><span class="p">{</span><span class="s2">"margin-left"</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="p">.</span><span class="nf">by</span><span class="o">*</span><span class="n">i</span><span class="p">})</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Element</span><span class="p">[</span><span class="s1">'#container'</span><span class="p">].</span><span class="nf">render</span> <span class="k">do</span>
  <span class="no">IndentEachLine</span><span class="p">(</span><span class="ss">by: </span><span class="mi">100</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">div</span> <span class="p">{</span><span class="s2">"Line 1"</span><span class="p">}</span>
    <span class="n">div</span> <span class="p">{</span><span class="s2">"Line 2"</span><span class="p">}</span>
    <span class="n">div</span> <span class="p">{</span><span class="s2">"Line 3"</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
        </div>
      </div>
    </div>

    <script>
      (function(Opal) {
        var self = Opal.top, $scope = Opal, nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;
        Opal.add_stubs(['$puts']);
        return self.$puts("Opal ok")
      })(Opal);
    </script>

    <!-- <script   src="http://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> -->

    <script type="text/ruby">puts "Hyperloop Express ok"</script>

    <script type="text/ruby">

class CodeMirror < React::Component::Base
  param :code, type: String
  define_state :error_message

  before_mount do
    state.error_message! ""
  end

  after_mount do
    @editor = `CodeMirror(document.getElementById("code"), {
      value: #{params.code},
      mode: "text/x-ruby",
      matchBrackets: true,
      lineNumbers: true,
      indentUnit: 2,
      theme: 'github'
    });`
    `#{@editor}.on('change', #{lambda {on_change} })`
    execute_code
  end

  render(DIV) do
    div(id: 'code')
    br
    div(id: 'result')
    p { state.error_message }
  end

  def on_change
    state.error_message! ""
    execute_code
  end

  after_mount   :execute_code
  after_update  :execute_code

  def execute_code
    compiled_code = Opal::Compiler.new(`#{@editor}.getValue()`).compile
    `ReactDOM.unmountComponentAtNode(document.getElementById("result"));`
    `eval(#{compiled_code})`
    Element['#result'].render{ Alfie() }
    rescue Exception => e
    @time_out = after(0.5) do
      state.error_message! e.message
    end
  end

end

class TestApp < React::Component::Base
  param :name
  before_mount { @timer = every(1) { force_update! } }
  render(DIV) do
    h1 {"The current time is #{Time.now}"}
    h2 { "here hello #{params.name}" }.on(:click) do
     alert "you clicked"
    end
  end
end

</script>


  </body>
</html>
