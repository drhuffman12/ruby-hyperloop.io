<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="qjqVOvRhHfsuDbLOvaAnj2mkUZJ9Xwzg84TMVXduvUc" />

    <meta charset="UTF-8">
    <title>Hyperloop - Hyper-React Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

    <!-- <link href="/stylesheets/base.css" rel="stylesheet" />
    <link href="/stylesheets/normalize.css" rel="stylesheet" />
    <link href="/stylesheets/stylesheet.css" rel="stylesheet" />
    <link href="/stylesheets/github-light.css" rel="stylesheet" /> -->

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="https://rawgit.com/reactrb/reactrb-express/master/reactrb-express.js"></script>

    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>

    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/codemirror.js"></script>
    <script src="/javascripts/ruby.js"></script>
    <script src="/javascripts/matchbrackets.js"></script>

    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="/stylesheets/override.css" rel="stylesheet" />
    <!-- <link href="/stylesheets/code.css" rel="stylesheet" /> -->
    <link href="/stylesheets/github.css" rel="stylesheet" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
    <link href="/stylesheets/codemirror.css" rel="stylesheet" />

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>

  <body>
    <div class="container">
      <nav class="navbar navbar-ligh">
  <button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2" aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-toggleable-xs" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a href="/" class="nav-link">Hyperloop</a>
      </li>
      <li class="nav-item">
        <a href="/get_started" class="nav-link active">Get Started</a>
      </li>
      <li class="nav-item">
        <a href="/tutorials" class="nav-link">Tutorials</a>
      </li>
      <li class="nav-item">
        <a href="/installation" class="nav-link">Installation</a>
      </li>
      <li class="nav-item">
        <a href="/gems" class="nav-link">Gems</a>
      </li>
      <li class="nav-item">
        <a href="https://github.com/ruby-hyperloop" class="nav-link">Github</a>
      </li>
      <li class="nav-item">
        <a href="/tools" class="nav-link">Tools</a>
      </li>
      <li class="nav-item">
        <a href="/docs/dsl_overview" class="nav-link">Docs</a>
      </li>
      <li class="nav-item">
        <a href="/support" class="nav-link">Support</a>
      </li>
      <li class="nav-item">
        <a href="/blog" class="nav-link">Blog</a>
      </li>
    </ul>
  </div>
</nav>

    </div>

    <div class="jumbotron page-header">
      <div class="container">
        <div class="row hidden-xs-down">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop_white.svg" width="180" alt="Hyperloop white" />
          </div>
          <div class="col-md-9">
            <h1 class="display-4 project-name">Hyperloop</h1>
            </br>
            <h2 class="display-7 project-tagline">
              HYPER-REACT DOCS
            </h2>
          </div>
        </div>
        <div class="row hidden-sm-up">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop_white.svg" width="120" alt="Hyperloop white" />
          </div>
          <div class="col-md-9">
            <h1 class="h1 project-name center-text">Hyperloop</h1>
            </br>
            <h2 class="h4 project-tagline center-text">
              HYPER-REACT DOCS
            </h2>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-3">
            <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/dsl_overview">HyperReact Overview</a></strong></br></li>
    <li class="nav-item"><a href="/docs/components_and_state">Components and State</a></br></li>
    <li class="nav-item"><a href="/docs/lifecycle_callbacks">Lifecycle Callbacks</a></br></li>
    <li class="nav-item"><a href="/docs/lifecycle_methods">Lifecycle Methods</a></br></li>
    <li class="nav-item"><a href="/docs/event_handelers">Event Handelers</a></br></li>
    <li class="nav-item"><a href="/docs/elements_rendering">Elements and Rendering</a></br></li>
    <li class="nav-item"><a href="/docs/javascript_components">Javascript Components</a></br></li>
    <li class="nav-item"><a href="/docs/further_reading">Further Reading</a></br></li>
  </ul>
  <br>
  <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/hypermesh_overview">HyperMesh Overview</a></strong></li>
    <li class="nav-item"><a href="/docs/hypermesh_active_record">ActiveRecord API</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_scoping">Scoping</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_authorization">Authorization</a></br></li>
    <li class="nav-item"><a href="/docs/hypermesh_debugging">Debugging</a></br></li>
  </ul>

          <br>
        </div>
        <div class="col-md-9 main-content">
          <h2 id="lifecycle-methods">Lifecycle Methods</h2>

<p>A component class may define callbacks for  specific points in a component&#39;s lifecycle.</p>

<h3 id="rendering">Rendering</h3>

<p>The lifecycle revolves around rendering the component.  As the state or parameters of a component changes, its render method will be called to generate the new HTML.  The rest of the callbacks hook into the lifecycle before or after rendering.</p>

<p>For reasons described below HyperReact provides a render callback to simplify defining the render method:</p>
<pre class="highlight ruby"><code><span class="n">render</span> <span class="k">do</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span><span class="nf">.</span>
<span class="k">end</span>
</code></pre>
<p>The render callback will generate the components render method.  It may optionally take the container component and params:</p>
<pre class="highlight ruby"><code><span class="n">render</span><span class="p">(</span><span class="ss">:div</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'my-class'</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>which would be equivilent to:</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">render</span>
  <span class="n">div</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'my-class'</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>
<span class="k">end</span>
</code></pre>
<p>The purpose of the render callback is syntactic.  Many components consist of a static outer container with possibly some parameters, and most component&#39;s render method by necessity will be longer than the normal <em>10 line</em> ruby style guideline.  The render call back solves both these problems by allowing the outer container to be specified as part of the callback parameter (which reads very nicely) and because the render code is now specified as a block you avoid the 10 line limitation, while encouraging the rest of your methods to adhere to normal ruby style guides</p>

<h3 id="before-mounting-first-render">Before Mounting (first render)</h3>
<pre class="highlight ruby"><code><span class="n">before_mount</span> <span class="k">do</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Invoked once when the component is first instantiated, immediately before the initial rendering occurs. This is where state variables should
be initialized.</p>

<p>This is the only life cycle method that is called during <code>render_to_string</code> used in server side pre-rendering.</p>

<h3 id="after-mounting-first-render">After Mounting (first render)</h3>
<pre class="highlight ruby"><code><span class="n">after_mount</span> <span class="k">do</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Invoked once, only on the client (not on the server), immediately after the initial rendering occurs. At this point in the lifecycle, you can access any refs to your children (e.g., to access the underlying DOM representation). The <code>after_mount</code> callbacks of children components are invoked before that of parent components.</p>

<p>If you want to integrate with other JavaScript frameworks, set timers using the <code>after</code> or <code>every</code> methods, or send AJAX requests, perform those operations in this method.  Attempting to perform such operations in before_mount will cause errors during prerendering because none of these operations are available in the server environment.</p>

<h3 id="before-receiving-new-params">Before Receiving New Params</h3>
<pre class="highlight ruby"><code><span class="n">before_receive_props</span> <span class="k">do</span> <span class="o">|</span><span class="n">new_params_hash</span><span class="o">|</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Invoked when a component is receiving <em>new</em> params (React.js props). This method is not called for the initial render.</p>

<p>Use this as an opportunity to react to a prop transition before <code>render</code> is called by updating any instance or state variables. The
new_props block parameter contains a hash of the new values.</p>
<pre class="highlight ruby"><code><span class="n">before_receive_props</span> <span class="k">do</span> <span class="o">|</span><span class="n">next_props</span><span class="o">|</span>
  <span class="n">state</span><span class="p">.</span><span class="nf">likes_increasing!</span> <span class="p">(</span><span class="n">next_props</span><span class="p">[</span><span class="ss">:like_count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">.</span><span class="nf">like_count</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<blockquote>
<p>Note:</p>

<p>There is no analogous method <code>before_receive_state</code>. An incoming param may cause a state change, but the opposite is not true. If you need to perform operations in response to a state change, use <code>before_update</code>.</p>
</blockquote>

<h3 id="controlling-updates">Controlling Updates</h3>

<p>Normally HyperReact will only update a component if some state variable or param has changed.  To override this behavior you can redefine the <code>should_component_update?</code> instance method.  For example, assume that we have a state called <code>funky</code> that for whatever reason, we
cannot update using the normal <code>state.funky!</code> update method.  So what we can do is override <code>should_component_update?</code> call <code>super</code>, and then double check if the <code>funky</code> has changed by doing an explicit comparison.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">RerenderMore</span> <span class="o">&lt;</span> <span class="no">React</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">should_component_update?</span><span class="p">(</span><span class="n">new_params_hash</span><span class="p">,</span> <span class="n">new_state_hash</span><span class="p">)</span>
    <span class="k">super</span> <span class="o">||</span> <span class="n">new_state_hash</span><span class="p">[</span><span class="ss">:funky</span><span class="p">]</span> <span class="o">!=</span> <span class="n">state</span><span class="p">.</span><span class="nf">funky</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>Why would this happen?  Most likely there is integration between new HyperReact components and other data structures being maintained outside of HyperReact, and so we have to do some explicit comparisons to detect the state change.</p>

<p>Note that <code>should_component_update?</code> is not called for the initial render or when <code>force_update!</code> is used.</p>

<blockquote>
<p>Note to react.js readers.  Essentially HyperReact assumes components are &quot;well behaved&quot; in the sense that all state changes
will be explicitly declared using the state update (&quot;!&quot;) method when changing state.  This gives similar behavior to a
&quot;pure&quot; component without the possible performance penalties.
To achieve the standard react.js behavior add this line to your class <code>def should_component_update?; true; end</code></p>
</blockquote>

<h3 id="before-updating-re-rendering">Before Updating (re-rendering)</h3>
<pre class="highlight ruby"><code><span class="n">before_update</span> <span class="k">do</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Invoked immediately before rendering when new params or state are bein#g received.  </p>

<h3 id="after-updating-re-rendering">After Updating (re-rendering)</h3>
<pre class="highlight ruby"><code><span class="n">after_update</span> <span class="k">do</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Invoked immediately after the component&#39;s updates are flushed to the DOM. This method is not called for the initial render.</p>

<p>Use this as an opportunity to operate on the DOM when the component has been updated.</p>

<h3 id="unmounting">Unmounting</h3>
<pre class="highlight ruby"><code><span class="n">before_unmount</span> <span class="k">do</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Invoked immediately before a component is unmounted from the DOM.</p>

<p>Perform any necessary cleanup in this method, such as invalidating timers or cleaning up any DOM elements that were created in the <code>after_mount</code> callback.</p>

        </div>
      </div>
    </div>

    <script>
      (function(Opal) {
        var self = Opal.top, $scope = Opal, nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;
        Opal.add_stubs(['$puts']);
        return self.$puts("Opal ok")
      })(Opal);
    </script>

    <!-- <script   src="http://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> -->

    <script type="text/ruby">puts "Hyperloop Express ok"</script>

    <script type="text/ruby">

class CodeMirror < React::Component::Base
  param :code, type: String
  define_state :error_message

  before_mount do
    state.error_message! ""
  end

  after_mount do
    @editor = `CodeMirror(document.getElementById("code"), {
      value: #{params.code},
      mode: "text/x-ruby",
      matchBrackets: true,
      lineNumbers: true,
      indentUnit: 2,
      theme: 'github'
    });`
    `#{@editor}.on('change', #{lambda {on_change} })`
    execute_code
  end

  render(DIV) do
    div(id: 'code')
    br
    div(id: 'result')
    p { state.error_message }
  end

  def on_change
    state.error_message! ""
    execute_code
  end

  after_mount   :execute_code
  after_update  :execute_code

  def execute_code
    compiled_code = Opal::Compiler.new(`#{@editor}.getValue()`).compile
    `ReactDOM.unmountComponentAtNode(document.getElementById("result"));`
    `eval(#{compiled_code})`
    Element['#result'].render{ Alfie() }
    rescue Exception => e
    @time_out = after(0.5) do
      state.error_message! e.message
    end
  end

end

class TestApp < React::Component::Base
  param :name
  before_mount { @timer = every(1) { force_update! } }
  render(DIV) do
    h1 {"The current time is #{Time.now}"}
    h2 { "here hello #{params.name}" }.on(:click) do
     alert "you clicked"
    end
  end
end

</script>


  </body>
</html>
